{% extends 'vendor/base.html' %}

{% block title %}Edit {{ product.name }} - Vendor Panel{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-4 pb-2 mb-4 border-b border-gray-700">
    <div>
        <h1 class="h3 font-weight-bold text-gray-100">
            <i class="fas fa-edit text-indigo-500 mr-2"></i>Edit Product
        </h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="{% url 'vendor:dashboard' %}" class="text-gray-400 hover:text-white">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="{% url 'vendor:product_list' %}" class="text-gray-400 hover:text-white">Products</a></li>
                <li class="breadcrumb-item"><a href="{% url 'vendor:product_detail' product.id %}" class="text-gray-400 hover:text-white">{{ product.name|truncatechars:20 }}</a></li>
                <li class="breadcrumb-item active text-indigo-400" aria-current="page">Edit</li>
            </ol>
        </nav>
    </div>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="{% url 'vendor:product_detail' product.id %}" class="px-4 py-2 text-sm font-medium text-gray-300 bg-gray-700/50 hover:bg-gray-700 rounded-lg border border-gray-600/50 transition-colors duration-200 flex items-center">
            <i class="fas fa-eye mr-2"></i>View Product
        </a>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card shadow-sm border-0 bg-gradient-to-br from-gray-800 to-gray-900 mb-6">
            <div class="card-header bg-gradient-to-r from-indigo-900/80 to-indigo-800/80 border-b border-indigo-700/50 px-6 py-4">
                <h5 class="text-lg font-bold text-white flex items-center">
                    <i class="fas fa-info-circle mr-2 text-indigo-300"></i>
                    Product Information
                </h5>
            </div>
            <div class="card-body p-6">
                <form method="post" class="space-y-6">
                    {% csrf_token %}
                    
                    <!-- Basic Information -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Product Name -->
                        <div class="space-y-2">
                            <label for="{{ form.name.id_for_label }}" class="block text-sm font-medium text-gray-300">
                                Product Name <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i class="fas fa-tag text-gray-500"></i>
                                </div>
                                {{ form.name }}
                            </div>
                            {% if form.name.errors %}
                                <div class="mt-1 text-red-400 text-sm">
                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                    {{ form.name.errors.0 }}
                                </div>
                            {% endif %}
                        </div>

                        <!-- Business -->
                        <div class="space-y-2">
                            <label for="{{ form.business.id_for_label }}" class="block text-sm font-medium text-gray-300">
                                Business <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i class="fas fa-store text-gray-500"></i>
                                </div>
                                {{ form.business }}
                            </div>
                            {% if form.business.errors %}
                                <div class="mt-1 text-red-400 text-sm">
                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                    {{ form.business.errors.0 }}
                                </div>
                            {% endif %}
                        </div>

                        <!-- Categories -->
                        <div class="space-y-2">
                            <label for="{{ form.categories.id_for_label }}" class="block text-sm font-medium text-gray-300">
                                Categories <span class="text-red-500">*</span>
                            </label>
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mt-2">
                                {% for choice in form.categories %}
                                    <label class="category-card flex items-center p-3 border border-gray-600 rounded-lg bg-gray-800/50 hover:bg-gray-700/50 cursor-pointer transition-colors duration-200">
                                        {{ choice.tag }}
                                        <span class="ml-2 text-sm text-gray-300">{{ choice.choice_label }}</span>
                                    </label>
                                {% endfor %}
                            </div>
                            {% if form.categories.errors %}
                                <div class="mt-1 text-red-400 text-sm">
                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                    {{ form.categories.errors.0 }}
                                </div>
                            {% endif %}
                        </div>

                        <!-- MOQ -->
                        <div class="space-y-2">
                            <label for="{{ form.moq.id_for_label }}" class="block text-sm font-medium text-gray-300">
                                Minimum Order Quantity (MOQ) <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i class="fas fa-boxes text-gray-500"></i>
                                </div>
                                {{ form.moq }}
                            </div>
                            <p class="mt-1 text-xs text-gray-400">Minimum quantity required for orders</p>
                            {% if form.moq.errors %}
                                <div class="mt-1 text-red-400 text-sm">
                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                    {{ form.moq.errors.0 }}
                                </div>
                            {% endif %}
                        </div>

                        
                    </div>

                    <!-- Description -->
                    <div class="space-y-2">
                        <label for="{{ form.description.id_for_label }}" class="block text-sm font-medium text-gray-300">
                            Description
                        </label>
                        {{ form.description }}
                        {% if form.description.errors %}
                            <div class="mt-1 text-red-400 text-sm">
                                <i class="fas fa-exclamation-circle mr-1"></i>
                                {{ form.description.errors.0 }}
                            </div>
                        {% endif %}
                        <p class="mt-1 text-xs text-gray-400">Provide detailed information about your product</p>
                    </div>
                    
                    <!-- Form Actions -->
                    <div class="flex items-center justify-end space-x-3 pt-4 border-t border-gray-700/50 mt-6">
                        <a href="{% url 'vendor:product_detail' product.id %}" class="px-4 py-2.5 text-sm font-medium text-gray-300 bg-gray-700/50 hover:bg-gray-700 rounded-lg border border-gray-600/50 transition-colors duration-200 flex items-center">
                            <i class="fas fa-times mr-2"></i> Cancel
                        </a>
                        <button type="submit" class="px-5 py-2.5 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg border border-indigo-500/30 transition-colors duration-200 flex items-center">
                            <i class="fas fa-save mr-2"></i> Update Product
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Product Preview Sidebar -->
    <div class="col-lg-4">
        <div class="card shadow-sm border-0 bg-gradient-to-br from-gray-800 to-gray-900 overflow-hidden">
            <div class="bg-gradient-to-r from-indigo-900/80 to-indigo-800/80 px-5 py-4 border-b border-indigo-700/50">
                <h3 class="text-lg font-bold text-white flex items-center">
                    <i class="fas fa-eye mr-2 text-indigo-300"></i>
                    Product Preview
                </h3>
            </div>
            <div class="p-5">
                {% with product.images.first as main_image %}
                    <div class="relative rounded-lg overflow-hidden bg-gray-800/50 border border-gray-700/50 mb-4">
                        {% if main_image %}
                            <img src="{{ main_image.image.url }}" 
                                 class="w-full h-48 object-cover"
                                 alt="{{ product.name }}">
                        {% else %}
                            <div class="w-full h-48 flex items-center justify-center bg-gray-800/50 text-gray-500">
                                <i class="fas fa-image text-4xl"></i>
                            </div>
                        {% endif %}
                        <div class="absolute top-2 right-2">
                            <span class="px-2 py-1 text-xs font-semibold rounded-full bg-indigo-600/80 text-white">
                                {{ product.get_status_display }}
                            </span>
                        </div>
                    </div>
                {% endwith %}
                
                <h4 class="text-lg font-bold text-white mb-1 truncate">{{ product.name }}</h4>
                
                <div class="flex items-center mb-3">
                    <span class="text-xl font-bold text-indigo-400">${{ product.price }}</span>
                    {% if product.compare_at_price and product.compare_at_price > product.price %}
                        <span class="ml-2 text-sm text-gray-400 line-through">${{ product.compare_at_price }}</span>
                        <span class="ml-2 text-xs bg-red-500/20 text-red-300 px-1.5 py-0.5 rounded">
                            {{ product.discount_percentage|floatformat:0 }}% OFF
                        </span>
                    {% endif %}
                </div>
                
                <div class="space-y-3">
                    <div class="flex items-center text-sm">
                        <span class="w-24 text-gray-400">MOQ:</span>
                        <span class="text-gray-200">{{ product.moq }} units</span>
                    </div>
                    <div class="flex items-center text-sm">
                        <span class="w-24 text-gray-400">SKU:</span>
                        <span class="text-gray-200 font-mono">{{ product.sku|default:"Not set" }}</span>
                    </div>
                    <div class="flex items-center text-sm">
                        <span class="w-24 text-gray-400">Category:</span>
                        <div class="flex flex-wrap gap-1">
                            {% for category in product.categories.all %}
                                <span class="px-2 py-0.5 bg-gray-700/50 text-gray-300 text-xs rounded-full">
                                    {{ category.name }}
                                </span>
                            {% empty %}
                                <span class="text-gray-500 text-sm">Uncategorized</span>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                
                <div class="mt-4 pt-4 border-t border-gray-700/50">
                    <h5 class="text-sm font-semibold text-gray-300 mb-2">Quick Actions</h5>
                    <div class="grid grid-cols-2 gap-2">
                        <a href="{% url 'vendor:add_product_image' product.id %}" 
                           class="px-3 py-2 text-xs font-medium text-center text-white bg-indigo-600/50 hover:bg-indigo-600 rounded-lg border border-indigo-500/30 transition-colors flex items-center justify-center">
                            <i class="fas fa-image mr-1.5"></i> Add Images
                        </a>
                        <a href="{% url 'vendor:product_detail' product.id %}" 
                           class="px-3 py-2 text-xs font-medium text-center text-gray-300 bg-gray-700/50 hover:bg-gray-700 rounded-lg border border-gray-600/30 transition-colors flex items-center justify-center">
                            <i class="fas fa-eye mr-1.5"></i> View Details
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Initialize form controls
    function initFormControls() {
        // Initialize select2 for better select elements
        if ($.fn.select2) {
            $('select[multiple]').select2({
                theme: 'bootstrap-5',
                width: '100%',
                placeholder: 'Select categories',
                allowClear: true
            });
        }
        
        
        
        // Add form validation
        $('form').on('submit', function(e) {
            let isValid = true;
            
            // Validate required fields
            $('[required]').each(function() {
                if (!$(this).val()) {
                    isValid = false;
                    $(this).addClass('border-red-500');
                } else {
                    $(this).removeClass('border-red-500');
                }
            });
            
            if (!isValid) {
                e.preventDefault();
                // Scroll to first error
                $('html, body').animate({
                    scrollTop: $('.border-red-500').first().offset().top - 100
                }, 500);
                return false;
            }
        });
    }
    
    // Initialize when document is ready
    initFormControls();
});
</script>

<style>
/* Custom styles for form elements */
select, input, textarea {
    background-color: rgba(31, 41, 55, 0.5) !important;
    border: 1px solid #374151 !important;
    color: #f3f4f6 !important;
    border-radius: 0.5rem !important;
    padding: 0.5rem 1rem 0.5rem 2.5rem !important;
    width: 100% !important;
    transition: all 0.2s;
}

/* Category card styling */
.category-card {
    position: relative;
    border: 1px solid #4b5563;
    background-color: rgba(31, 41, 55, 0.5);
    transition: all 0.2s ease;
}

.category-card:hover {
    border-color: #6366f1;
    background-color: rgba(99, 102, 241, 0.1);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
}

.category-card input[type="checkbox"] {
    position: absolute;
    opacity: 0;
    pointer-events: none;
}

.category-card input[type="checkbox"]:checked + span {
    color: #60a5fa;
    font-weight: 600;
}

.category-card:has(input[type="checkbox"]:checked) {
    border-color: #3b82f6;
    background-color: rgba(59, 130, 246, 0.1);
    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
}

.category-card:has(input[type="checkbox"]:checked)::before {
    content: "✓";
    position: absolute;
    top: 8px;
    right: 8px;
    color: #3b82f6;
    font-weight: bold;
    font-size: 14px;
}

select:focus, input:focus, textarea:focus {
    border-color: #818cf8 !important;
    box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.3) !important;
    outline: none !important;
}

/* Style for select2 elements */
.select2-container--bootstrap-5 .select2-selection {
    background-color: rgba(31, 41, 55, 0.5) !important;
    border: 1px solid #374151 !important;
    color: #f3f4f6 !important;
    min-height: 42px;
}

.select2-container--bootstrap-5 .select2-selection--multiple .select2-selection__choice {
    background-color: #4b5563;
    border: 1px solid #4b5563;
    color: #f3f4f6;
    border-radius: 0.375rem;
}

.select2-container--bootstrap-5 .select2-dropdown {
    background-color: #1f2937;
    border: 1px solid #374151;
}

.select2-container--bootstrap-5 .select2-results__option {
    color: #f3f4f6;
    padding: 0.5rem 1rem;
}

.select2-container--bootstrap-5 .select2-results__option--highlighted {
    background-color: #4f46e5 !important;
    color: white !important;
}

/* Style for error states */
.border-red-500 {
    border-color: #ef4444 !important;
}

/* Custom scrollbar */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: #1f2937;
}

::-webkit-scrollbar-thumb {
    background: #4b5563;
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: #6b7280;
}

/* Animation for form sections */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.card-body > * {
    animation: fadeIn 0.3s ease-out forwards;
}

/* Delay animations for better visual effect */
.card-body > *:nth-child(1) { animation-delay: 0.1s; }
.card-body > *:nth-child(2) { animation-delay: 0.2s; }
.card-body > *:nth-child(3) { animation-delay: 0.3s; }
</style>
{% endblock %}
