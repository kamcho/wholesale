{% extends 'vendor/base.html' %}

{% block title %}Add Product Variation - {{ product.name }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-4 pb-2 mb-4 border-b border-gray-700">
    <div>
        <h1 class="h3 font-weight-bold text-gray-100">
            <i class="fas fa-plus-circle text-indigo-500 mr-2"></i>Add Variation
        </h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="{% url 'vendor:dashboard' %}" class="text-gray-400 hover:text-white">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="{% url 'vendor:product_list' %}" class="text-gray-400 hover:text-white">Products</a></li>
                <li class="breadcrumb-item"><a href="{% url 'vendor:product_detail' product.id %}" class="text-gray-400 hover:text-white">{{ product.name|truncatechars:20 }}</a></li>
                <li class="breadcrumb-item active text-indigo-400" aria-current="page">Add Variation</li>
            </ol>
        </nav>
    </div>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="{% url 'vendor:product_detail' product.id %}" class="px-4 py-2 text-sm font-medium text-gray-300 bg-gray-700/50 hover:bg-gray-700 rounded-lg border border-gray-600/50 transition-colors duration-200 flex items-center">
            <i class="fas fa-arrow-left mr-2"></i> Back to Product
        </a>
    </div>
</div>

{% if messages %}
<div class="mb-4">
    {% for message in messages %}
    <div class="px-4 py-3 rounded-lg {% if message.tags == 'error' %}bg-red-900/30 text-red-200 border border-red-800/50{% else %}bg-indigo-900/30 text-indigo-200 border border-indigo-800/50{% endif %} flex items-center justify-between">
        <div class="flex items-center">
            <i class="fas {% if message.tags == 'error' %}fa-exclamation-circle{% else %}fa-info-circle{% endif %} mr-2"></i>
            {{ message }}
        </div>
        <button type="button" class="text-gray-400 hover:text-white" data-dismiss="alert" aria-label="Close">
            <i class="fas fa-times"></i>
        </button>
    </div>
    {% endfor %}
</div>
{% endif %}

<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-tags me-2"></i>Variation Information
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Product:</strong> {{ product.name }}
                </div>
                
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.name.id_for_label }}" class="form-label">Variation Name *</label>
                            {{ form.name }}
                            {% if form.name.errors %}
                                <div class="text-danger small mt-1">
                                    {% for error in form.name.errors %}
                                        <div>{{ error }}</div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">e.g., "Color: Red", "Size: XL", "Material: Cotton"</div>
                        </div>
                        
                        <div class="col-md-3 mb-3">
                            <label for="{{ form.moq.id_for_label }}" class="form-label">MOQ *</label>
                            {{ form.moq }}
                            {% if form.moq.errors %}
                                <div class="text-danger small mt-1">
                                    {% for error in form.moq.errors %}
                                        <div>{{ error }}</div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">Minimum units for this variation</div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="{{ form.price.id_for_label }}" class="form-label">Variation Price *</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                {{ form.price }}
                            </div>
                            {% if form.price.errors %}
                                <div class="text-danger small mt-1">
                                    {% for error in form.price.errors %}
                                        <div>{{ error }}</div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">Price for this specific variation</div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.order.id_for_label }}" class="form-label">Display Order</label>
                            {{ form.order }}
                            {% if form.order.errors %}
                                <div class="text-danger small mt-1">
                                    {% for error in form.order.errors %}
                                        <div>{{ error }}</div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">Order in which this variation appears (0 = first)</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.closes_on.id_for_label }}" class="form-label">Closes On</label>
                            {{ form.closes_on }}
                            {% if form.closes_on.errors %}
                                <div class="text-danger small mt-1">
                                    {% for error in form.closes_on.errors %}
                                        <div>{{ error }}</div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">When this variation stops accepting orders (optional)</div>
                        </div>
                    </div>
                    

                    <div class="d-flex gap-2 mt-4">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>Add Variation
                        </button>
                        <a href="{% url 'vendor:product_detail' product.id %}" class="btn btn-secondary">
                            <i class="fas fa-times me-2"></i>Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h6 class="card-title mb-0">
                    <i class="fas fa-info-circle me-2"></i>About Variations
                </h6>
            </div>
            <div class="card-body">
                <p class="card-text small">
                    Product variations allow you to offer different options of the same product with different prices.
                </p>
                <ul class="list-unstyled mb-0">
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        <strong>Color variations:</strong> "Color: Red", "Color: Blue"
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        <strong>Size variations:</strong> "Size: S", "Size: M", "Size: L"
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        <strong>Material variations:</strong> "Material: Cotton", "Material: Polyester"
                    </li>
                    <li class="mb-0">
                        <i class="fas fa-check text-success me-2"></i>
                        <strong>Custom variations:</strong> Any specific attribute
                    </li>
                </ul>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h6 class="card-title mb-0">
                    <i class="fas fa-lightbulb me-2"></i>Tips
                </h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        Use clear, descriptive names
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        Set appropriate prices for each variation
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        Use display order to control listing sequence
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        Set closing date for time-limited variations
                    </li>
                    <li class="mb-0">
                        <i class="fas fa-check text-success me-2"></i>
                        Upload one clear image per variation
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Basic form validation
document.addEventListener('DOMContentLoaded', function() {
    // Add form validation
    const form = document.querySelector('form');
    if (form) {
        form.addEventListener('submit', function(e) {
            let isValid = true;
            
            // Check required fields
            const requiredFields = form.querySelectorAll('input[required], select[required], textarea[required]');
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('is-invalid');
                    isValid = false;
                } else {
                    field.classList.remove('is-invalid');
                }
            });
            
            if (!isValid) {
                e.preventDefault();
                alert('Please fill in all required fields.');
            }
        });
        
        // Remove validation classes on input
        const inputs = form.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            input.addEventListener('input', function() {
                this.classList.remove('is-invalid');
            });
        });
    }
});
</script>

<style>
/* Basic form styling */
.is-invalid {
    border-color: #dc3545;
}

.invalid-feedback {
    display: block;
    width: 100%;
    margin-top: 0.25rem;
    font-size: 0.875em;
    color: #dc3545;
}
</style>

{% endblock %}


