{% extends 'vendor/base.html' %}
{% load static %}

{% block title %}Add Attribute - {{ product.name }}{% endblock %}

{% block extra_css %}
<style>
  :root {
    --primary-color: #818cf8;
    --primary-hover: #6366f1;
    --bg-dark: #111827;
    --bg-darker: #0f172a;
    --text-light: #f8fafc;
    --text-muted: #94a3b8;
    --border-dark: #1e293b;
    --input-bg: #1e293b;
    --input-border: #334155;
  }

  body {
    @apply bg-gray-900 text-gray-100;
  }

  /* Form Elements */
  .form-input {
    @apply w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 
           focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200;
  }
  
  .form-label {
    @apply block text-sm font-medium text-gray-200 mb-1;
  }
  
  .input-group {
    @apply relative flex items-stretch w-full;
  }
  
  .input-icon {
    @apply absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400;
  }
  
  /* Buttons */
  .btn {
    @apply px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center justify-center;
  }
  
  .btn-primary {
    @apply bg-indigo-600 text-white hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2;
  }
  
  .btn-outline {
    @apply border border-gray-600 text-gray-300 hover:bg-gray-800 focus:ring-2 focus:ring-indigo-500;
  }
  
  /* Tabs */
  .tab-button {
    @apply flex-1 py-3 px-4 text-center font-medium text-white hover:text-indigo-300 border-b-2 
           border-transparent hover:border-indigo-400 transition-all duration-200;
  }
  
  .tab-button.active {
    @apply text-white border-indigo-400;
  }
  
  /* Error Messages */
  .error-message {
    @apply text-sm text-red-400 mt-1 flex items-center;
  }
  
  .error-message i {
    @apply mr-1;
  }
  
  /* Select Dropdown */
  select {
    @apply w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white 
           focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200;
  }
  
  select option {
    @apply bg-gray-800 text-white;
  }
  
  /* Custom Dark Theme Overrides */
  .bg-white {
    @apply bg-gray-800;
  }
  
  .text-gray-900 {
    @apply text-gray-100;
  }
  
  .text-gray-700 {
    @apply text-gray-300;
  }
  
  .border-gray-200 {
    @apply border-gray-700;
  }
  
  .bg-indigo-50 {
    @apply bg-gray-800;
  }
  
  .text-gray-600 {
    @apply text-gray-400;
  }
  
  .bg-indigo-100 {
    @apply bg-gray-700;
  }
  
  .text-indigo-600 {
    @apply text-indigo-400;
  }
</style>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 min-h-screen">
  <!-- Header -->
  <div class="mb-8">
    <div class="flex items-center justify-between mb-4">
      <div>
        <nav class="flex" aria-label="Breadcrumb">
          <ol class="flex items-center space-x-2 text-sm">
            <li>
              <a href="{% url 'vendor:product_list' %}" class="text-indigo-400 hover:text-indigo-300">Products</a>
            </li>
            <li class="text-gray-400">/</li>
            <li>
              <a href="{% url 'vendor:product_detail' product.id %}" class="text-indigo-400 hover:text-indigo-300">{{ product.name|truncatechars:20 }}</a>
            </li>
            <li class="text-gray-400">/</li>
            <li>
              <a href="{% url 'vendor:variation_detail' variation.id %}" class="text-indigo-400 hover:text-indigo-300">{{ variation.name|truncatechars:20 }}</a>
            </li>
            <li class="text-gray-400">/</li>
            <li class="text-gray-600 font-medium">Add Attribute</li>
          </ol>
        </nav>
        <h1 class="text-2xl font-bold text-white mt-2">Add Product Attribute</h1>
      </div>
      <a href="{% url 'vendor:variation_detail' variation.id %}" class="btn btn-outline">
        <i class="fas fa-arrow-left mr-2"></i>Back to Variation
      </a>
    </div>
  </div>

  <!-- Main Content -->
  <div class="bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-700">
    <!-- Product Info Banner -->
    <div class="bg-gray-700 p-4 border-b border-gray-600">
      <div class="flex items-start">
        <div class="flex-shrink-0">
          <div class="h-10 w-10 rounded-lg bg-indigo-900/50 flex items-center justify-center">
            <i class="fas fa-info-circle text-indigo-600"></i>
          </div>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-gray-100">Product Information</h3>
          <div class="mt-1 text-sm text-gray-300">
            <p><span class="font-medium">Product:</span> {{ product.name }}</p>
            <p><span class="font-medium">Variation:</span> {{ variation.name }}</p>
          </div>
        </div>
      </div>
    </div>

    <form method="post" id="attributeForm" class="p-6">
      {% csrf_token %}
      <input type="hidden" name="form_type" id="formType" value="new">

      {% if form.non_field_errors %}
      <div class="bg-red-900/30 rounded-lg border border-red-800">
        <div class="flex">
          <div class="flex-shrink-0">
            <i class="fas fa-exclamation-circle text-red-500"></i>
          </div>
          <div class="ml-3">
            <h3 class="text-sm font-medium text-red-800">There were errors with your submission</h3>
            <div class="mt-2 text-sm text-red-700">
              <ul class="list-disc pl-5 space-y-1">
                {% for error in form.non_field_errors %}
                <li>{{ error }}</li>
                {% endfor %}
              </ul>
            </div>
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Tab Navigation -->
      <div class="border-b border-gray-700 mb-6">
        <nav class="-mb-px flex space-x-8">
          <button type="button" 
                  class="tab-button active" 
                  data-tab="new-attribute"
                  data-form-type="new">
            <i class="fas fa-plus-circle mr-2" style="color: #6366f1;"></i>Create New Attribute
          </button>
          <button type="button" 
                  class="tab-button" 
                  data-tab="existing-attribute"
                  data-form-type="existing">
            <i class="fas fa-list mr-2"></i>Use Existing Attribute
          </button>
        </nav>
      </div>

      <!-- Tab Content -->
      <div>
        <!-- New Attribute Form -->
        <div id="new-attribute" class="tab-content active">
          <div class="space-y-6">
            <div>
              <h3 class="text-lg font-medium text-gray-900 mb-4" style="color:white;">
                <i class="fas fa-magic text-indigo-500 mr-2"></i>Create New Attribute
              </h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label for="{{ form.new_attribute_name.id_for_label }}" class="form-label">
                    <i class="fas fa-tag text-gray-400 mr-1"></i> Attribute Name
                  </label>
                  <div class="mt-1 relative rounded-md shadow-sm">
                    <div class="input-icon">
                      <i class="fas fa-font"></i>
                    </div>
                    <input type="text" 
                           name="{{ form.new_attribute_name.name }}" 
                           id="{{ form.new_attribute_name.id_for_label }}"
                           class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 pl-10 text-white placeholder-gray-400"
                           placeholder="Enter attribute name"
                           value="{{ form.new_attribute_name.value|default:'' }}">
                  </div>
                  {% if form.new_attribute_name.errors %}
                    {% for error in form.new_attribute_name.errors %}
                      <p class="error-message"><i class="fas fa-exclamation-circle"></i> {{ error }}</p>
                    {% endfor %}
                  {% endif %}
                  <p class="text-sm text-gray-400">{{ form.new_attribute_name.help_text }}</p>
                </div>
                
                <div>
                  <label for="{{ form.new_attribute_value.id_for_label }}" class="form-label text-gray-400">
                    <i class="fas fa-palette text-gray-400 mr-1"></i> Attribute Value
                  </label>
                  <div class="mt-1 relative rounded-md shadow-sm">
                    <div class="input-icon">
                      <i class="fas fa-tag"></i>
                    </div>
                    <input type="text" 
                           name="{{ form.new_attribute_value.name }}" 
                           id="{{ form.new_attribute_value.id_for_label }}"
                           class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 pl-10 text-white placeholder-gray-400"
                           placeholder="Enter attribute value"
                           value="{{ form.new_attribute_value.value|default:'' }}">
                  </div>
                  {% if form.new_attribute_value.errors %}
                    {% for error in form.new_attribute_value.errors %}
                      <p class="error-message"><i class="fas fa-exclamation-circle"></i> {{ error }}</p>
                    {% endfor %}
                  {% endif %}
                  <p class="text-sm text-gray-400">{{ form.new_attribute_value.help_text }}</p>
                </div>
                
                <div class="md:col-span-2">
                  <label for="{{ form.new_attribute_description.id_for_label }}" class="form-label text-gray-400">
                    <i class="fas fa-align-left text-gray-400 mr-1"></i> Description (Optional)
                  </label>
                  <div class="mt-1">
                    <textarea name="{{ form.new_attribute_description.name }}" 
                              id="{{ form.new_attribute_description.id_for_label }}"
                              class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 text-white placeholder-gray-400"
                              rows="3"
                              placeholder="Enter description (optional)">{{ form.new_attribute_description.value|default:'' }}</textarea>
                  </div>
                  {% if form.new_attribute_description.errors %}
                    {% for error in form.new_attribute_description.errors %}
                      <p class="error-message"><i class="fas fa-exclamation-circle"></i> {{ error }}</p>
                    {% endfor %}
                  {% endif %}
                  <p class="text-sm text-gray-400">{{ form.new_attribute_description.help_text }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Existing Attribute Form -->
        <div id="existing-attribute" class="tab-content hidden">
          <div class="space-y-6">
            <h3 class="text-lg font-medium text-gray-900 mb-4">
              <i class="fas fa-list-ul text-indigo-500 mr-2"></i>Select Existing Attribute
            </h3>
            <div>
              <label for="{{ form.existing_value.id_for_label }}" class="form-label text-gray-400">
                <i class="fas fa-tags text-gray-400 mr-1"></i> Choose Attribute
              </label>
              <div class="mt-1">
                <select name="{{ form.existing_value.name }}" 
                        id="{{ form.existing_value.id_for_label }}"
                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 text-white">
                    {% for value, label in form.existing_value.field.choices %}
                        <option value="{{ value }}" {% if form.existing_value.value == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
              </div>
              {% if form.existing_value.errors %}
                {% for error in form.existing_value.errors %}
                  <p class="error-message"><i class="fas fa-exclamation-circle"></i> {{ error }}</p>
                {% endfor %}
              {% endif %}
              <p class="text-sm text-gray-400">{{ form.existing_value.help_text }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="mt-8 pt-6 border-t border-gray-700 flex items-center justify-between">
        <a href="{% url 'vendor:variation_detail' variation.id %}" class="btn btn-outline">
          <i class="fas fa-times mr-2"></i>Cancel
        </a>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-save mr-2"></i>Save Attribute
        </button>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Tab switching functionality
  const tabButtons = document.querySelectorAll('.tab-button');
  const tabContents = document.querySelectorAll('.tab-content');
  const formTypeInput = document.getElementById('formType');

  tabButtons.forEach(button => {
    button.addEventListener('click', (e) => {
      e.preventDefault();
      const tabId = button.getAttribute('data-tab');
      const formType = button.getAttribute('data-form-type');
      
      // Update active tab
      tabButtons.forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');
      
      // Show selected tab content
      tabContents.forEach(content => {
        content.classList.add('hidden');
        if (content.id === tabId) {
          content.classList.remove('hidden');
          content.classList.add('active');
        } else {
          content.classList.remove('active');
        }
      });
      
      // Update form type
      if (formTypeInput) {
        formTypeInput.value = formType;
      }
    });
  });

  // Form submission handling
  const form = document.getElementById('attributeForm');
  if (form) {
    form.addEventListener('submit', function(e) {
      const formType = document.getElementById('formType').value;
      
      // Validate based on active tab
      if (formType === 'new') {
        const nameField = document.getElementById('{{ form.new_attribute_name.id_for_label }}');
        const valueField = document.getElementById('{{ form.new_attribute_value.id_for_label }}');
        
        if (!nameField.value.trim() || !valueField.value.trim()) {
          e.preventDefault();
          alert('Please fill in all required fields for the new attribute.');
          return false;
        }
      } else {
        const existingValue = document.getElementById('{{ form.existing_value.id_for_label }}');
        if (!existingValue.value) {
          e.preventDefault();
          alert('Please select an existing attribute value.');
          return false;
        }
      }
    });
  }
});
</script>
{% endblock %}
