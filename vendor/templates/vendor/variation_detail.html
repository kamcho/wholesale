{% extends 'vendor/base.html' %}
{% load static %}
{% load math_filters %}

{% block title %}Variation Details - {{ product.name }}{% endblock %}

{% block extra_css %}
{{ block.super }}
<style>
  /* Hover Effects */
  .hover-lift {
    transition: all 0.3s ease;
  }
  .hover-lift:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
  }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-4">
  <div class="row">
    <main class="col-12">
<div class="relative overflow-hidden rounded-xl bg-gradient-to-r from-gray-800 to-gray-900 shadow-lg mb-6">
  <!-- Subtle noise texture -->
  <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0IiBoZWlnaHQ9IjQiPgo8cmVjdCB3aWR0aD0iNCIgaGVpZ2h0PSI0IiBmaWxsPSIjMDAwMDAwIj48L3JlY3Q+CjxwYXRoIGQ9Ik0wIDBMNCA0Wk00IDBMMCA0WiIgc3Ryb2tlLXdpZHRoPSIwLjUiIHN0cm9rZT0icmdiYSgyNTUsMjU1LDI1NSwwLjA1KSIvPgo8L3N2Zz4=')] opacity-10"></div>
  
  <div class="relative px-6 py-4">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between">
      <div class="flex items-center">
        <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
          </svg>
        </div>
        <div class="ml-4">
          <h1 class="text-xl font-bold text-white">{{ variation.name }}</h1>
          <p class="text-sm text-indigo-200">Variation of {{ product.name }}</p>
        </div>
      </div>
      
      <div class="mt-4 flex flex-wrap gap-2 md:mt-0">
        <a href="{% url 'vendor:product_detail' product.id %}" 
           class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-200 bg-gray-700/50 hover:bg-gray-600/70 rounded-lg border border-gray-600/50 hover:border-gray-500 transition-all duration-200 hover:shadow-md">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
          </svg>
          Back to Product
        </a>
        
        <a href="{% url 'vendor:edit_product_variation' variation.id %}" 
           class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-500 rounded-lg border border-indigo-500 hover:border-indigo-400 transition-all duration-200 hover:shadow-md">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
          </svg>
          Edit
        </a>
        
        <a href="{% url 'vendor:add_variation_attribute' variation.id %}" 
           class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-500 rounded-lg border border-green-500 hover:border-green-400 transition-all duration-200 hover:shadow-md">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
          </svg>
          Add Attribute
        </a>
      </div>
    </div>
  </div>
</div>

<div class="flex flex-col xl:flex-row gap-6">
  <div class="w-full xl:w-8/12">
    <!-- Left Content Area -->
    <!-- Variation Overview Card -->
    <div class="bg-gray-800 rounded-xl shadow-lg overflow-hidden mb-6 border border-gray-700 hover:border-blue-500/30 transition-all duration-300 hover:shadow-xl">
      <!-- Card Header -->
      <div class="px-6 py-4 border-b border-gray-700 bg-gradient-to-r from-gray-800 to-gray-900">
        <div class="flex items-center">
          <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </div>
          <h2 class="ml-3 text-lg font-semibold text-white">Variation Overview</h2>
        </div>
      </div>
      
      <!-- Card Body -->
      <div class="p-6">
        <!-- Key Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
          <!-- Price per Unit -->
          <div class="group relative overflow-hidden rounded-xl bg-gray-700/50 hover:bg-gray-700/70 border border-gray-600/50 hover:border-emerald-500/30 transition-all duration-300 p-5">
            <div class="absolute inset-0 bg-gradient-to-br from-emerald-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
            <div class="relative z-10 flex items-center">
              <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-emerald-500 to-teal-500 rounded-xl flex items-center justify-center shadow-lg">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
              <div class="ml-4">
                <div class="text-sm font-medium text-gray-300">Price per Unit</div>
                <div class="text-2xl font-bold text-white">${{ variation.price }}</div>
              </div>
            </div>
          </div>
          
          <!-- Minimum Order -->
          <div class="group relative overflow-hidden rounded-xl bg-gray-700/50 hover:bg-gray-700/70 border border-gray-600/50 hover:border-blue-500/30 transition-all duration-300 p-5">
            <div class="absolute inset-0 bg-gradient-to-br from-blue-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
            <div class="relative z-10 flex items-center">
              <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-xl flex items-center justify-center shadow-lg">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                </svg>
              </div>
              <div class="ml-4">
                <div class="text-sm font-medium text-gray-300">Minimum Order</div>
                <div class="text-2xl font-bold text-white">{{ variation.moq }} <span class="text-sm font-normal text-gray-400">units</span></div>
              </div>
            </div>
          </div>
          
          <!-- Last Updated -->
          <div class="group relative overflow-hidden rounded-xl bg-gray-700/50 hover:bg-gray-700/70 border border-gray-600/50 hover:border-purple-500/30 transition-all duration-300 p-5">
            <div class="absolute inset-0 bg-gradient-to-br from-purple-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
            <div class="relative z-10 flex items-center">
              <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center shadow-lg">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
              <div class="ml-4">
                <div class="text-sm font-medium text-gray-300">Created</div>
                <div class="text-xl font-semibold text-white">{{ variation.created_at|date:"M d, Y" }}</div>
                <div class="text-sm text-gray-400">{{ variation.created_at|date:"H:i" }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Product Attributes Section -->
        <div class="bg-gray-800/50 rounded-xl border border-gray-700 overflow-hidden">
          <div class="px-5 py-4 border-b border-gray-700 bg-gradient-to-r from-gray-800 to-gray-900">
            <div class="flex items-center">
              <div class="flex-shrink-0 w-9 h-9 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center shadow-md">
                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                </svg>
              </div>
              <h3 class="ml-3 text-base font-semibold text-white">Product Attributes</h3>
              <div class="ml-auto">
                <a href="{% url 'vendor:add_variation_attribute' variation.id %}" class="inline-flex items-center px-3 py-1.5 text-xs font-medium text-white bg-indigo-600 hover:bg-indigo-500 rounded-lg border border-indigo-500 hover:border-indigo-400 transition-all duration-200">
                  <svg class="w-3.5 h-3.5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                  </svg>
                  Add Attribute
                </a>
              </div>
            </div>
          </div>
          <div class="p-5">
            <p class="text-gray-400 text-sm">No attributes added yet. Click "Add Attribute" to get started.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Analytics Card -->
    <div class="bg-gray-800 rounded-xl shadow-lg overflow-hidden mb-6 border border-gray-700 hover:border-purple-500/30 transition-all duration-300 hover:shadow-xl">
      <div class="px-6 py-4 border-b border-gray-700 bg-gradient-to-r from-gray-800 to-gray-900">
        <div class="flex items-center">
          <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
            </svg>
          </div>
          <h2 class="ml-3 text-lg font-semibold text-white">Variation Analytics</h2>
        </div>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <!-- In Carts -->
          <div class="group relative overflow-hidden rounded-xl bg-gray-700/50 hover:bg-gray-700/70 border border-gray-600/50 hover:border-blue-500/30 transition-all duration-300 p-5">
            <div class="absolute inset-0 bg-gradient-to-br from-blue-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
            <div class="relative z-10 flex items-center">
              <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-xl flex items-center justify-center shadow-lg">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
                </svg>
              </div>
              <div class="ml-4">
                <div class="text-sm font-medium text-gray-300">In Carts</div>
                <div class="text-2xl font-bold text-white">{{ cart_count }}</div>
                <div class="text-xs text-gray-400">Active shopping carts</div>
              </div>
            </div>
          </div>
          
          <!-- Orders -->
          <div class="group relative overflow-hidden rounded-xl bg-gray-700/50 hover:bg-gray-700/70 border border-gray-600/50 hover:border-emerald-500/30 transition-all duration-300 p-5">
            <div class="absolute inset-0 bg-gradient-to-br from-emerald-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
            <div class="relative z-10 flex items-center">
              <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-emerald-500 to-teal-500 rounded-xl flex items-center justify-center shadow-lg">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                </svg>
              </div>
              <div class="ml-4">
                <div class="text-sm font-medium text-gray-300">Total Orders</div>
                <div class="text-2xl font-bold text-white">{{ order_count }}</div>
                <div class="text-xs text-gray-400">Number of times ordered</div>
              </div>
            </div>
          </div>
          
          <!-- Order Requests -->
          <div class="group relative overflow-hidden rounded-xl bg-gray-700/50 hover:bg-gray-700/70 border border-gray-600/50 hover:border-amber-500/30 transition-all duration-300 p-5">
            <div class="absolute inset-0 bg-gradient-to-br from-amber-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
            <div class="relative z-10 flex items-center">
              <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-500 rounded-xl flex items-center justify-center shadow-lg">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/>
                </svg>
              </div>
              <div class="ml-4">
                <div class="text-sm font-medium text-gray-300">Order Requests</div>
                <div class="text-2xl font-bold text-white">{{ order_request_count }}</div>
                <div class="text-xs text-gray-400">Number of order requests</div>
              </div>
            </div>
          </div>
          
          <!-- Total Quantity -->
          <div class="group relative overflow-hidden rounded-xl bg-gray-700/50 hover:bg-gray-700/70 border border-gray-600/50 hover:border-purple-500/30 transition-all duration-300 p-5">
            <div class="absolute inset-0 bg-gradient-to-br from-purple-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
            <div class="relative z-10 flex items-center">
              <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                </svg>
              </div>
              <div class="ml-4">
                <div class="text-sm font-medium text-gray-300">Total Quantity Ordered</div>
                <div class="text-2xl font-bold text-white">{{ total_ordered }}</div>
                <div class="text-xs text-gray-400">Total units sold</div>
              </div>
            </div>
          </div>
          
          <!-- Total Revenue -->
          <div class="group relative overflow-hidden rounded-xl bg-gray-700/50 hover:bg-gray-700/70 border border-gray-600/50 hover:border-teal-500/30 transition-all duration-300 p-5">
            <div class="absolute inset-0 bg-gradient-to-br from-teal-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
            <div class="relative z-10 flex items-center">
              <div class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-teal-500 to-cyan-500 rounded-xl flex items-center justify-center shadow-lg">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
              <div class="ml-4">
                <div class="text-sm font-medium text-gray-300">Total Revenue</div>
                <div class="text-2xl font-bold text-white">${{ total_revenue|default:"0.00"|floatformat:2 }}</div>
                <div class="text-xs text-gray-400">Total revenue generated</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Orders Section -->
    {% if recent_orders %}
    <div class="bg-gray-800 rounded-xl shadow-lg overflow-hidden mb-6 border border-gray-700 hover:border-blue-500/30 transition-all duration-300 hover:shadow-xl">
      <div class="px-6 py-4 border-b border-gray-700 bg-gradient-to-r from-gray-800 to-gray-900">
        <div class="flex items-center justify-between">
          <div class="flex items-center">
            <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-md">
              <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/>
              </svg>
            </div>
            <h3 class="ml-3 text-lg font-semibold text-white">Recent Orders</h3>
          </div>
          <a href="{% url 'vendor:orders' %}" class="text-sm font-medium text-blue-400 hover:text-blue-300 transition-colors">
            View All
            <svg class="w-4 h-4 inline ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </a>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-700">
          <thead class="bg-gray-700/50">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Order #</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Customer</th>
              <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider">Quantity</th>
              <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider">Amount</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Date</th>
              <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-300 uppercase tracking-wider">Status</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-700">
            {% for item in recent_orders %}
            <tr class="hover:bg-gray-700/50 transition-colors duration-150">
              <td class="px-6 py-4 whitespace-nowrap">
                <a href="{% url 'vendor:order_detail' item.order.id %}" class="text-blue-400 hover:text-blue-300 font-medium">
                  #{{ item.order.id|stringformat:"06d" }}
                </a>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-200">
                  {% with user=item.order.user %}
                    {{ user.get_full_name|default:user.username|default:user.email|default:'Guest User'|truncatechars:20 }}
                  {% endwith %}
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-right text-sm text-gray-300">
                {{ item.quantity }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium text-white">
                KSh {{ item.price|floatformat:2 }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">
                {{ item.order.created_at|date:"M d, Y" }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-center">
                {% with status=item.order.status|lower %}
                  {% if status == 'pending' %}
                    <span class="px-2.5 py-1 text-xs font-medium rounded-full bg-yellow-500/20 text-yellow-300">
                  {% elif status == 'processing' %}
                    <span class="px-2.5 py-1 text-xs font-medium rounded-full bg-blue-500/20 text-blue-300">
                  {% elif status == 'completed' %}
                    <span class="px-2.5 py-1 text-xs font-medium rounded-full bg-green-500/20 text-green-300">
                  {% elif status == 'cancelled' %}
                    <span class="px-2.5 py-1 text-xs font-medium rounded-full bg-red-500/20 text-red-300">
                  {% else %}
                    <span class="px-2.5 py-1 text-xs font-medium rounded-full bg-gray-500/20 text-gray-300">
                  {% endif %}
                    {{ item.order.get_status_display }}
                  </span>
                {% endwith %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="px-6 py-3 border-t border-gray-700 bg-gray-800/50 text-right">
        <a href="{% url 'vendor:orders' %}" class="inline-flex items-center text-sm font-medium text-blue-400 hover:text-blue-300 transition-colors">
          View all orders
          <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </a>
      </div>
    </div>
    {% endif %}

    <!-- Recent Order Requests Section -->
    {% if recent_order_requests %}
    <div class="bg-gray-800 rounded-xl shadow-lg overflow-hidden mb-6 border border-gray-700 hover:border-amber-500/30 transition-all duration-300 hover:shadow-xl">
      <div class="px-6 py-4 border-b border-gray-700 bg-gradient-to-r from-gray-800 to-gray-900">
        <div class="flex items-center justify-between">
          <div class="flex items-center">
            <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-500 rounded-lg flex items-center justify-center shadow-md">
              <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4m5 1a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
            <h3 class="ml-3 text-lg font-semibold text-white">Recent Order Requests</h3>
          </div>
          <a href="{% url 'vendor:order_requests' %}" class="text-sm font-medium text-amber-400 hover:text-amber-300 transition-colors">
            View All
            <svg class="w-4 h-4 inline ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </a>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-700">
          <thead class="bg-gray-700/50">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Request #</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Customer</th>
              <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider">Quantity</th>
              <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider">Proposed Price</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Date</th>
              <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-300 uppercase tracking-wider">Status</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-700">
            {% for item in recent_order_requests %}
            <tr class="hover:bg-gray-700/50 transition-colors duration-150">
              <td class="px-6 py-4 whitespace-nowrap">
                <a href="{% url 'vendor:vendor_order_request_detail' item.order_request.id %}" class="text-amber-400 hover:text-amber-300 font-medium">
                  #{{ item.order_request.id|stringformat:"06d" }}
                </a>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-200">
                  {% with user=item.order_request.user %}
                    {{ user.get_full_name|default:user.username|default:user.email|default:'Guest User'|truncatechars:20 }}
                  {% endwith %}
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-right text-sm text-gray-300">
                {{ item.quantity }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium {% if item.unit_price < variation.price %}text-red-400{% else %}text-green-400{% endif %}">
                KSh {{ item.unit_price|floatformat:2|default:"-" }}
                {% if item.unit_price %}
                  <span class="text-xs text-gray-400 block">
                    {% if item.unit_price < variation.price %}
                      ({{ variation.price|sub:item.unit_price|floatformat:2 }} below)
                    {% else %}
                      ({{ item.unit_price|sub:variation.price|floatformat:2 }} above)
                    {% endif %}
                  </span>
                {% endif %}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">
                {{ item.order_request.created_at|date:"M d, Y" }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-center">
                {% with status=item.order_request.status|lower %}
                  {% if status == 'pending' %}
                    <span class="px-2.5 py-1 text-xs font-medium rounded-full bg-amber-500/20 text-amber-300">
                  {% elif status == 'accepted' %}
                    <span class="px-2.5 py-1 text-xs font-medium rounded-full bg-green-500/20 text-green-300">
                  {% elif status == 'rejected' %}
                    <span class="px-2.5 py-1 text-xs font-medium rounded-full bg-red-500/20 text-red-300">
                  {% elif status == 'completed' %}
                    <span class="px-2.5 py-1 text-xs font-medium rounded-full bg-blue-500/20 text-blue-300">
                  {% else %}
                    <span class="px-2.5 py-1 text-xs font-medium rounded-full bg-gray-500/20 text-gray-300">
                  {% endif %}
                    {{ item.order_request.get_status_display }}
                  </span>
                {% endwith %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="px-6 py-3 border-t border-gray-700 bg-gray-800/50 text-right">
        <a href="{% url 'vendor:order_requests' %}" class="inline-flex items-center text-sm font-medium text-amber-400 hover:text-amber-300 transition-colors">
          View all requests
          <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </a>
      </div>
    </div>
    {% endif %}

    <!-- Variation Images Card -->
    <div class="bg-gray-800 rounded-xl shadow-lg overflow-hidden mb-6 border border-gray-700 hover:border-purple-500/30 transition-all duration-300 hover:shadow-xl">
      <div class="px-6 py-4 border-b border-gray-700 bg-gradient-to-r from-gray-800 to-gray-900">
        <div class="flex items-center justify-between">
          <div class="flex items-center">
            <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg flex items-center justify-center shadow-md">
              <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
            </div>
            <h3 class="ml-3 text-lg font-semibold text-white">Variation Images</h3>
          </div>
          <a href="{% url 'vendor:add_variation_image' variation.id %}" class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white text-sm font-medium rounded-lg shadow-sm transition-all duration-200 border border-purple-600/30 hover:border-purple-500/50">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
            </svg>
            Add Image
          </a>
        </div>
      </div>
      <div class="p-6">
        {% if images %}
          <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
            {% for image in images %}
            <div class="group relative">
              <div class="relative overflow-hidden rounded-xl border border-gray-700 group-hover:border-purple-500/50 transition-all duration-300">
                <img 
                  src="{{ image.image.url }}" 
                  class="w-full h-48 md:h-56 object-cover bg-gray-700/50" 
                  alt="{{ image.caption|default:variation.name }}" 
                  loading="lazy"
                >
                {% if image.is_default %}
                  <span class="absolute top-2 left-2 inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-green-600/90 to-emerald-600/90 text-white shadow-md">
                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"/>
                    </svg>
                    Default
                  </span>
                {% endif %}
                <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-3">
                  <div class="flex space-x-2">
                    <a href="#" class="p-1.5 bg-gray-800/80 hover:bg-gray-700/90 rounded-lg text-white transition-colors">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                      </svg>
                    </a>
                    <a href="#" class="p-1.5 bg-gray-800/80 hover:bg-red-600/90 rounded-lg text-white transition-colors">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                      </svg>
                    </a>
                    {% if not image.is_default %}
                    <a href="#" class="p-1.5 bg-gray-800/80 hover:bg-green-600/90 rounded-lg text-white transition-colors">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                      </svg>
                    </a>
                    {% endif %}
                  </div>
                </div>
              </div>
              {% if image.caption %}
              <div class="mt-2 px-2">
                <p class="text-sm text-gray-300 truncate" title="{{ image.caption }}">
                  {{ image.caption }}
                </p>
              </div>
              {% endif %}
            </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="text-center py-10 px-4">
            <div class="w-24 h-24 bg-gradient-to-br from-gray-700/50 to-gray-800/80 rounded-full flex items-center justify-center mx-auto mb-5 border-2 border-dashed border-gray-600/50">
              <svg class="w-10 h-10 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
            </div>
            <h4 class="text-lg font-medium text-gray-200 mb-1">No images uploaded yet</h4>
            <p class="text-gray-400 mb-5 max-w-md mx-auto">Add high-quality images to showcase your product variation from different angles</p>
            <a href="{% url 'vendor:add_variation_image' variation.id %}" class="inline-flex items-center px-5 py-2.5 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white text-sm font-medium rounded-lg shadow-md transition-all duration-200 border border-purple-600/30 hover:border-purple-500/50">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
              </svg>
              Upload Your First Image
            </a>
          </div>
        {% endif %}
      </div>
    </div>

    <!-- Bulk Pricing (Price Tiers) Section -->
    <div class="bg-gray-800 rounded-xl shadow-lg overflow-hidden mb-6 border border-gray-700 hover:border-orange-500/30 transition-all duration-300 hover:shadow-xl">
      <div class="px-6 py-4 border-b border-gray-700 bg-gradient-to-r from-gray-800 to-gray-900">
        <div class="flex items-center justify-between">
          <div class="flex items-center">
            <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-orange-500 to-red-600 rounded-lg flex items-center justify-center shadow-md">
              <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
              </svg>
            </div>
            <h3 class="ml-3 text-lg font-semibold text-white">Bulk Pricing (Price Tiers)</h3>
          </div>
        </div>
      </div>
      
      <div class="p-6">
        <form method="post" class="space-y-6" id="price-tier-form">
          {% csrf_token %}
          <input type="hidden" name="price_tier_submit" value="1" />
          
          <div id="price-tiers-container" class="space-y-4">
            {{ price_tier_formset.management_form }}
            {% for form in price_tier_formset %}
              <div class="price-tier-row p-5 rounded-xl border border-gray-700 bg-gray-800/50 hover:bg-gray-800/70 transition-colors duration-200 group">
                <div class="grid grid-cols-1 md:grid-cols-12 gap-4 items-end">
                  <!-- Min Quantity -->
                  <div class="md:col-span-3">
                    <label class="block text-sm font-medium text-gray-300 mb-1">
                      Min Quantity
                      <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                      <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <span class="text-gray-400">≥</span>
                      </div>
                      <input type="number" name="{{ form.min_quantity.name }}" 
                             id="{{ form.min_quantity.id_for_label }}" 
                             value="{{ form.min_quantity.value|default:'' }}"
                             class="pl-8 pr-3 py-2.5 w-full bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                             placeholder="Min quantity"
                             required>
                    </div>
                    {% if form.min_quantity.errors %}
                      <p class="mt-1 text-sm text-red-400">{{ form.min_quantity.errors.0 }}</p>
                    {% endif %}
                  </div>
                  
                  <!-- Max Quantity -->
                  <div class="md:col-span-3">
                    <label class="block text-sm font-medium text-gray-300 mb-1">
                      Max Quantity
                      <span class="text-xs text-gray-400">(0 for no max)</span>
                    </label>
                    <div class="relative">
                      <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <span class="text-gray-400">≤</span>
                      </div>
                      <input type="number" name="{{ form.max_quantity.name }}" 
                             id="{{ form.max_quantity.id_for_label }}" 
                             value="{{ form.max_quantity.value|default:'' }}"
                             class="pl-8 pr-3 py-2.5 w-full bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                             placeholder="Max quantity (0 for no max)">
                    </div>
                    {% if form.max_quantity.errors %}
                      <p class="mt-1 text-sm text-red-400">{{ form.max_quantity.errors.0 }}</p>
                    {% endif %}
                  </div>
                  
                  <!-- Price per Unit -->
                  <div class="md:col-span-3">
                    <label class="block text-sm font-medium text-gray-300 mb-1">
                      Price per Unit
                      <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                      <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <span class="text-gray-400">KSh</span>
                      </div>
                      <input type="number" name="{{ form.price.name }}" 
                             id="{{ form.price.id_for_label }}" 
                             value="{{ form.price.value|default:'' }}"
                             step="0.01"
                             min="0"
                             class="pl-14 pr-3 py-2.5 w-full bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                             placeholder="0.00"
                             required>
                    </div>
                    {% if form.price.errors %}
                      <p class="mt-1 text-sm text-red-400">{{ form.price.errors.0 }}</p>
                    {% endif %}
                  </div>
                  
                  <!-- Delete Button -->
                  <div class="md:col-span-2 flex items-end space-x-2">
                    {% if price_tier_formset.can_delete and form.instance.pk %}
                      <button type="button" 
                              class="delete-tier-btn p-2 text-gray-400 hover:text-red-400 rounded-lg hover:bg-gray-700 transition-colors duration-200"
                              data-tier-id="{{ form.instance.pk }}"
                              data-bs-toggle="tooltip" 
                              title="Delete this tier">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                        </svg>
                      </button>
                    {% elif price_tier_formset.can_delete %}
                      <button type="button" 
                              class="remove-tier-btn p-2 text-gray-400 hover:text-red-400 rounded-lg hover:bg-gray-700 transition-colors duration-200"
                              data-bs-toggle="tooltip" 
                              title="Remove this tier">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                        </svg>
                      </button>
                    {% endif %}
                    {{ form.id }}
                    {% if price_tier_formset.can_delete %}
                      {{ form.DELETE }}
                    {% endif %}
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
          
          <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0 mt-6 pt-5 border-t border-gray-700">
            <button type="button" id="add-tier" class="inline-flex items-center px-4 py-2.5 bg-gray-700 hover:bg-gray-600 text-white text-sm font-medium rounded-lg border border-gray-600 hover:border-orange-500/50 transition-all duration-200">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
              </svg>
              Add Price Tier
            </button>
            
            <button type="submit" class="inline-flex items-center px-5 py-2.5 bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white font-medium rounded-lg shadow-md hover:shadow-lg transition-all duration-200 border border-orange-600/50">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
              Save Price Tiers
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Promise Fee Card -->
    <div class="bg-gray-800 rounded-xl shadow-lg overflow-hidden mb-6 border border-gray-700 hover:border-emerald-500/30 transition-all duration-300 hover:shadow-xl">
      <div class="px-6 py-4 border-b border-gray-700 bg-gradient-to-r from-gray-800 to-gray-900">
        <div class="flex items-center justify-between">
          <div class="flex items-center">
            <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-lg flex items-center justify-center shadow-md">
              <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"/>
              </svg>
            </div>
            <h3 class="ml-3 text-lg font-semibold text-white">Promise Fee</h3>
          </div>
          {% if not promise_fees or not promise_fees.0 %}
            <button type="button" id="add-promise-fee" class="inline-flex items-center px-4 py-2 bg-emerald-600 hover:bg-emerald-500 text-white text-sm font-medium rounded-lg border border-emerald-500 hover:border-emerald-400 transition-all duration-200">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
              </svg>
              Add Promise Fee
            </button>
          {% endif %}
        </div>
      </div>
      
      <div class="p-6">
        {% if promise_fees and promise_fees.0 %}
          {% with fee=promise_fees.0 %}
          <form method="post" id="promise-fee-form" class="space-y-6">
            {% csrf_token %}
            <input type="hidden" name="promise_fee_submit" value="1" />
            
            <div class="p-5 rounded-xl border border-gray-700 bg-gray-800/50 hover:bg-gray-800/70 transition-colors duration-200">
              <div class="grid grid-cols-1 md:grid-cols-12 gap-4 items-end">
                <div class="md:col-span-5">
                  <label class="block text-sm font-medium text-gray-300 mb-1">
                    Fee Name
                    <span class="text-red-500">*</span>
                  </label>
                  <input type="text" 
                         name="fee_name" 
                         class="w-full px-3 py-2.5 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                         value="{{ fee.name }}" 
                         placeholder="e.g., Standard Promise Fee"
                         required>
                </div>
                
                <div class="md:col-span-3">
                  <label class="block text-sm font-medium text-gray-300 mb-1">
                    Min Percentage
                    <span class="text-red-500">*</span>
                  </label>
                  <div class="relative">
                    <input type="number" 
                           name="fee_min_percent" 
                           class="w-full pl-3 pr-8 py-2.5 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                           value="{{ fee.min_percent|floatformat:2 }}" 
                           step="0.01" 
                           min="0" 
                           max="100"
                           required>
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                      <span class="text-gray-400">%</span>
                    </div>
                  </div>
                </div>
                
                <div class="md:col-span-3">
                  <label class="block text-sm font-medium text-gray-300 mb-1">
                    Max Percentage
                    <span class="text-red-500">*</span>
                  </label>
                  <div class="relative">
                    <input type="number" 
                           name="fee_max_percent" 
                           class="w-full pl-3 pr-8 py-2.5 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
                           value="{{ fee.max_percent|floatformat:2 }}" 
                           step="0.01" 
                           min="0" 
                           max="100"
                           required>
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                      <span class="text-gray-400">%</span>
                    </div>
                  </div>
                </div>
                
                <div class="md:col-span-1 flex items-end">
                  <button type="button" 
                          class="delete-promise-fee w-full p-2.5 text-gray-400 hover:text-red-400 rounded-lg hover:bg-gray-700 transition-colors duration-200 flex items-center justify-center"
                          data-fee-id="{{ fee.id }}">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                  </button>
                </div>
              </div>
              
              <div class="mt-4 pt-4 border-t border-gray-700">
                <div class="flex justify-between items-center">
                  <div class="text-sm text-gray-400">
                    Last updated: {{ fee.updated_at|date:"M d, Y H:i" }}
                  </div>
                  <button type="submit" class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white text-sm font-medium rounded-lg shadow-md hover:shadow-lg transition-all duration-200 border border-emerald-600/50">
                    <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                    Update Fee
                  </button>
                </div>
              </div>
            </div>
          </form>
          {% endwith %}
        {% else %}
          <div class="text-center py-8 px-4 bg-gray-800/50 rounded-xl border-2 border-dashed border-gray-700 hover:border-emerald-500/50 transition-all duration-300">
            <div class="w-16 h-16 bg-gradient-to-br from-gray-700/50 to-gray-800/80 rounded-full flex items-center justify-center mx-auto mb-4 border-2 border-dashed border-gray-600/50">
              <svg class="w-8 h-8 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
            <h4 class="text-lg font-medium text-gray-200 mb-2">No Promise Fee Added</h4>
            <p class="text-gray-400 mb-5 max-w-md mx-auto">Add a promise fee to set the minimum and maximum percentage for this variation.</p>
            <button type="button" id="add-promise-fee" class="inline-flex items-center px-5 py-2.5 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white text-sm font-medium rounded-lg shadow-md hover:shadow-lg transition-all duration-200 border border-emerald-600/50">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
              </svg>
              Add Promise Fee
            </button>
          </div>
          
          <!-- Hidden form for adding a new fee -->
          <form method="post" id="add-promise-fee-form" class="hidden">
            {% csrf_token %}
            <input type="hidden" name="promise_fee_submit" value="1" />
            <input type="hidden" name="fee_name" value="Standard Promise Fee" />
            <input type="hidden" name="fee_min_percent" value="5.00" />
            <input type="hidden" name="fee_max_percent" value="10.00" />
          </form>
        {% endif %}
      </div>
    </div>

    <!-- Interest Rates Card -->
    <div class="bg-gray-800 rounded-xl shadow-lg overflow-hidden mb-6 border border-gray-700 hover:border-amber-500/30 transition-all duration-300 hover:shadow-xl">
      <div class="px-6 py-4 border-b border-gray-700 bg-gradient-to-r from-gray-800 to-gray-900">
        <div class="flex items-center justify-between">
          <div class="flex items-center">
            <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-500 rounded-lg flex items-center justify-center shadow-md">
              <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
            </div>
            <h3 class="ml-3 text-lg font-semibold text-white">Interest Rates</h3>
          </div>
          {% if not i_rates or not i_rates.0 %}
            <button type="button" id="add-interest-rate" class="inline-flex items-center px-4 py-2 bg-amber-600 hover:bg-amber-500 text-white text-sm font-medium rounded-lg border border-amber-500 hover:border-amber-400 transition-all duration-200">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
              </svg>
              Add Rate
            </button>
          {% endif %}
        </div>
      </div>
      
      <div class="p-6">
        {% if i_rates and i_rates.0 %}
          {% for rate in i_rates %}
          <form method="post" id="interest-rate-form-{{ rate.id }}" class="space-y-6 mb-6">
            {% csrf_token %}
            <input type="hidden" name="i_rate_submit" value="1" />
            <input type="hidden" name="rate_id" value="{{ rate.id }}" />
            
            <div class="p-5 rounded-xl border border-gray-700 bg-gray-800/50 hover:bg-gray-800/70 transition-colors duration-200">
              <div class="grid grid-cols-1 md:grid-cols-12 gap-4 items-end">
                <!-- Lower Range -->
                <div class="md:col-span-3">
                  <label class="block text-sm font-medium text-gray-300 mb-1">
                    Lower Range
                    <span class="text-red-500">*</span>
                  </label>
                  <input type="number" 
                         name="lower_range" 
                         class="w-full px-3 py-2.5 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-amber-500 focus:border-amber-500"
                         value="{{ rate.lower_range }}" 
                         min="0" 
                         step="0.01"
                         required>
                </div>
                
                <!-- Upper Range -->
                <div class="md:col-span-3">
                  <label class="block text-sm font-medium text-gray-300 mb-1">
                    Upper Range
                    <span class="text-xs text-gray-400">(0 for no limit)</span>
                  </label>
                  <input type="number" 
                         name="upper_range" 
                         class="w-full px-3 py-2.5 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-amber-500 focus:border-amber-500"
                         value="{{ rate.upper_range|default:0 }}" 
                         min="0" 
                         step="0.01">
                </div>
                
                <!-- Rate -->
                <div class="md:col-span-3">
                  <label class="block text-sm font-medium text-gray-300 mb-1">
                    Rate
                    <span class="text-red-500">*</span>
                  </label>
                  <div class="relative">
                    <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">$</span>
                    <input type="number" 
                           name="rate" 
                           class="w-full pl-8 pr-3 py-2.5 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-amber-500 focus:border-amber-500"
                           value="{{ rate.rate|floatformat:2 }}" 
                           step="0.01" 
                           min="0" 
                           required>
                  </div>
                </div>
                
                <!-- Must Pay Shipping -->
                <div class="md:col-span-2 flex items-center">
                  <label class="flex items-center cursor-pointer">
                    <input type="checkbox" 
                           name="must_pay_shipping" 
                           class="h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded"
                           {% if rate.must_pay_shipping %}checked{% endif %}>
                    <span class="ml-3 text-sm font-medium text-gray-300">Shipping Required</span>
                  </label>
                </div>
                
                <!-- Delete Button -->
                <div class="md:col-span-1 flex items-end justify-end">
                  <button type="button" 
                          class="delete-interest-rate w-full p-2.5 text-gray-400 hover:text-red-400 rounded-lg hover:bg-gray-700 transition-colors duration-200 flex items-center justify-center"
                          data-rate-id="{{ rate.id }}">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                  </button>
                </div>
              </div>
              
              <div class="mt-4 pt-4 border-t border-gray-700">
                <div class="flex justify-between items-center">
                  <div class="text-sm text-gray-400">
                    Last updated: {{ rate.updated_at|date:"M d, Y H:i" }}
                  </div>
                  <button type="submit" class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700 text-white text-sm font-medium rounded-lg shadow-md hover:shadow-lg transition-all duration-200 border border-amber-600/50">
                    <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                    Update Rate
                  </button>
                </div>
              </div>
            </div>
          </form>
          {% endfor %}
        {% else %}
          <div class="text-center py-8 px-4 bg-gray-800/50 rounded-xl border-2 border-dashed border-gray-700 hover:border-amber-500/50 transition-all duration-300">
            <div class="w-16 h-16 bg-gradient-to-br from-gray-700/50 to-gray-800/80 rounded-full flex items-center justify-center mx-auto mb-4 border-2 border-dashed border-gray-600/50">
              <svg class="w-8 h-8 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
            <h4 class="text-lg font-medium text-gray-200 mb-2">No Interest Rates Added</h4>
            <p class="text-gray-400 mb-5 max-w-md mx-auto">Add interest rates to define pricing tiers based on quantity ranges.</p>
            <button type="button" id="add-interest-rate" class="inline-flex items-center px-5 py-2.5 bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700 text-white text-sm font-medium rounded-lg shadow-md hover:shadow-lg transition-all duration-200 border border-amber-600/50">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
              </svg>
              Add Interest Rate
            </button>
          </div>
          
          <!-- Hidden form for adding a new rate -->
          <form method="post" id="add-interest-rate-form" class="hidden">
            {% csrf_token %}
            <input type="hidden" name="i_rate_submit" value="1" />
            <input type="hidden" name="lower_range" value="1" />
            <input type="hidden" name="upper_range" value="0" />
            <input type="hidden" name="rate" value="0.00" />
            <input type="hidden" name="must_pay_shipping" value="false" />
          </form>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="w-full xl:w-4/12">
    <!-- Knowledge Base Card -->
    <div class="bg-gray-800 rounded-xl shadow-lg overflow-hidden mb-6 border border-gray-700 hover:border-indigo-500/30 transition-all duration-300 hover:shadow-xl">
      <div class="px-6 py-4 border-b border-gray-700 bg-gradient-to-r from-gray-800 to-gray-900">
        <div class="flex items-center">
          <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-indigo-500 to-violet-600 rounded-lg flex items-center justify-center shadow-md">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
          </div>
          <h3 class="ml-3 text-lg font-semibold text-white">Knowledge Base</h3>
        </div>
      </div>
      <div class="p-6">
        <form method="post" action="{% url 'vendor:variation_detail' variation.id %}" class="space-y-4">
          {% csrf_token %}
          <input type="hidden" name="kb_submit" value="1">
          
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">Product Information</label>
            {{ kb_form.content }}
            <div class="mt-1 text-xs text-gray-400">
              Enter any product details, specifications, or notes. Use any format you prefer.
            </div>
            {% if kb_form.content.errors %}
              <div class="mt-1 text-sm text-red-400">{{ kb_form.content.errors|join:", " }}</div>
            {% endif %}
          </div>
          
          <div>
            <button type="submit" class="w-full inline-flex items-center justify-center px-4 py-2 bg-gradient-to-r from-indigo-600 to-violet-600 hover:from-indigo-700 hover:to-violet-700 text-white text-sm font-medium rounded-lg shadow-md hover:shadow-lg transition-all duration-200 border border-indigo-600/50">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/>
              </svg>
              Save Knowledge Base
            </button>
          </div>
        </form>
        
        {% if kb_entry and kb_entry.content %}
        <div class="mt-6 pt-4 border-t border-gray-700">
          <h6 class="text-xs font-medium text-gray-400 uppercase tracking-wider mb-3">Saved Information</h6>
          <div class="bg-gray-700/50 rounded-lg p-4 border border-gray-600/50">
            <div class="text-sm text-gray-300 whitespace-pre-line">
              {% with content=kb_entry.content|stringformat:"s"|cut:"{"|cut:"}"|cut:'"'|cut:"'"|linebreaksbr %}
                {{ content }}
              {% endwith %}
            </div>
          </div>
        </div>
        {% endif %}
      </div>
    </div>
    
    <!-- Quick Actions Card -->
    <div class="bg-gradient-to-br from-indigo-600 to-purple-700 rounded-xl shadow-lg overflow-hidden border border-indigo-500/30 hover:border-indigo-400/50 transition-all duration-300 hover:shadow-xl">
      <div class="px-6 py-4 border-b border-white/20 bg-gradient-to-r from-indigo-600/90 to-purple-700/90">
        <div class="flex items-center">
          <div class="flex-shrink-0 w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center shadow-md">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
          </div>
          <h3 class="ml-3 text-lg font-semibold text-white">Quick Actions</h3>
        </div>
      </div>
      <div class="p-6 space-y-3">
        <a href="{% url 'vendor:edit_product_variation' variation.id %}" class="w-full inline-flex items-center justify-center px-4 py-3 bg-white/10 hover:bg-white/20 text-white text-sm font-medium rounded-lg border border-white/20 hover:border-white/30 transition-all duration-200 hover:shadow-md">
          <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
          </svg>
          <span class="font-semibold">Edit Variation</span>
        </a>
        <a href="{% url 'vendor:add_variation_attribute' variation.id %}" class="w-full inline-flex items-center justify-center px-4 py-3 bg-white/5 hover:bg-white/15 text-white text-sm font-medium rounded-lg border border-white/20 hover:border-white/30 transition-all duration-200 hover:shadow-md">
          <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
          </svg>
          <span class="font-semibold">Add Attribute</span>
        </a>
        <a href="{% url 'vendor:add_variation_image' variation.id %}" class="w-full inline-flex items-center justify-center px-4 py-3 bg-white/5 hover:bg-white/15 text-white text-sm font-medium rounded-lg border border-white/20 hover:border-white/30 transition-all duration-200 hover:shadow-md">
          <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
          <span class="font-semibold">Add Image</span>
        </a>
        <a href="{% url 'vendor:product_detail' product.id %}" class="w-full inline-flex items-center justify-center px-4 py-3 bg-white/5 hover:bg-white/15 text-white text-sm font-medium rounded-lg border border-white/20 hover:border-white/30 transition-all duration-200 hover:shadow-md">
          <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
          </svg>
          <span class="font-semibold">Back to Product</span>
        </a>
        
        <!-- Active/Inactive Toggle Form -->
        <form method="post" action="{% url 'vendor:toggle_variation_active' variation.id %}" class="w-full">
          {% csrf_token %}
          <input type="hidden" name="is_active" value="{% if variation.is_active %}false{% else %}true{% endif %}">
          <button type="submit" 
                  class="w-full inline-flex items-center justify-center px-4 py-3 {% if variation.is_active %}bg-green-600/90 hover:bg-green-700 border-green-500/50 hover:border-green-400/70{% else %}bg-gray-600/90 hover:bg-gray-700 border-gray-500/50 hover:border-gray-400/70{% endif %} text-white text-sm font-medium rounded-lg border transition-all duration-200 hover:shadow-md">
            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              {% if variation.is_active %}
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
              {% else %}
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" />
              {% endif %}
            </svg>
            <span class="font-semibold">
              {% if variation.is_active %}
                <span class="block">Active</span>
                <span class="text-xs font-normal opacity-80 block">Visible to customers</span>
              {% else %}
                <span class="block">Inactive</span>
                <span class="text-xs font-normal opacity-80 block">Hidden from customers</span>
              {% endif %}
            </span>
          </button>
        </form>
        
        <!-- Archive Button -->
        <button type="button" 
                class="w-full inline-flex items-center justify-center px-4 py-3 bg-amber-600/90 hover:bg-amber-700 text-white text-sm font-medium rounded-lg border border-amber-500/50 hover:border-amber-400/70 transition-all duration-200 hover:shadow-md archive-variation-btn"
                data-variation-id="{{ variation.id }}">
          <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
          </svg>
          <span class="font-semibold">Archive Variation</span>
        </button>
        
        <!-- Enhanced Tip Section -->
        <div class="mt-6 p-4 bg-white/10 backdrop-blur-sm rounded-lg border border-white/20">
          <div class="flex items-start">
            <div class="w-8 h-8 bg-yellow-400 rounded-full flex items-center justify-center mr-3 flex-shrink-0">
              <svg class="w-4 h-4 text-yellow-800" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
              </svg>
            </div>
            <div>
              <div class="text-white font-semibold mb-1">Pro Tip</div>
              <div class="text-white/80 text-sm">
                Use attributes to define product variations like size, color, or material. Add images to showcase different options and attract more buyers.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteConfirmationModalLabel">Confirm Deletion</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this item? This action cannot be undone.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
      </div>
    </div>
  </div>
</div>

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Initialize tooltips
  var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
  });
  
  // CSRF token setup for AJAX
  const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

  // Handle active/inactive toggle
  document.querySelectorAll('.toggle-active-btn').forEach(button => {
    button.addEventListener('click', function() {
      const variationId = this.dataset.variationId;
      const isCurrentlyActive = this.dataset.isActive === 'true';
      const newActiveState = !isCurrentlyActive;
      const buttonContainer = this.closest('.group');
      
      // Show loading state
      const originalText = this.innerHTML;
      this.disabled = true;
      this.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>';
      
      // Send update request
      fetch(`/vendor/variations/${variationId}/toggle-active/`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': csrftoken,
          'X-Requested-With': 'XMLHttpRequest',
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          is_active: newActiveState
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Update button appearance
          this.dataset.isActive = newActiveState.toString();
          const iconSvg = this.querySelector('svg');
          const textSpan = this.querySelector('.font-semibold');
          
          if (newActiveState) {
            // Update to active state
            this.classList.remove('bg-gray-600/90', 'hover:bg-gray-700', 'border-gray-500/50', 'hover:border-gray-400/70');
            this.classList.add('bg-green-600/90', 'hover:bg-green-700', 'border-green-500/50', 'hover:border-green-400/70');
            
            // Update icon to visible eye
            iconSvg.innerHTML = `
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
            `;
            
            // Update text
            textSpan.innerHTML = `
              <span class="block">Active</span>
              <span class="text-xs font-normal opacity-80 block">Visible to customers</span>
            `;
            
            // Update tooltip
            buttonContainer.title = 'Visible to customers. Click to hide.';
          } else {
            // Update to inactive state
            this.classList.remove('bg-green-600/90', 'hover:bg-green-700', 'border-green-500/50', 'hover:border-green-400/70');
            this.classList.add('bg-gray-600/90', 'hover:bg-gray-700', 'border-gray-500/50', 'hover:border-gray-400/70');
            
            // Update icon to crossed eye
            iconSvg.innerHTML = `
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" />
            `;
            
            // Update text
            textSpan.innerHTML = `
              <span class="block">Inactive</span>
              <span class="text-xs font-normal opacity-80 block">Hidden from customers</span>
            `;
            
            // Update tooltip
            buttonContainer.title = 'Hidden from customers. Click to make visible.';
          }
          
          // Reinitialize tooltip
          const tooltip = bootstrap.Tooltip.getInstance(buttonContainer);
          if (tooltip) {
            tooltip.dispose();
            new bootstrap.Tooltip(buttonContainer);
          }
          
          showAlert(`Variation is now ${newActiveState ? 'visible' : 'hidden'} to customers`, 'success');
        } else {
          throw new Error(data.error || 'Failed to update variation status');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showAlert('Error updating variation status: ' + error.message, 'danger');
      })
      .finally(() => {
        this.disabled = false;
        this.innerHTML = originalText;
      });
    });
  });

  // Handle archive variation button click
  document.querySelectorAll('.archive-variation-btn').forEach(button => {
    button.addEventListener('click', function() {
      const variationId = this.dataset.variationId;
      
      if (confirm('Are you sure you want to archive this variation? It will be hidden but can be restored later.')) {
        // Show loading state
        const originalText = this.innerHTML;
        this.disabled = true;
        this.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Archiving...';
        
        // Send archive request
        fetch(`/vendor/variations/${variationId}/archive/`, {
          method: 'POST',
          headers: {
            'X-CSRFToken': csrftoken,
            'X-Requested-With': 'XMLHttpRequest',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({})
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Show success message and redirect to product detail
            showAlert('Variation archived successfully!', 'success');
            // Redirect to product detail page after a short delay
            setTimeout(() => {
              window.location.href = `{% url 'vendor:product_detail' product.id %}`;
            }, 1500);
          } else {
            throw new Error(data.error || 'Failed to archive variation');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          showAlert('Error archiving variation: ' + error.message, 'danger');
          // Reset button state
          this.disabled = false;
          this.innerHTML = originalText;
        });
      }
    });
  });

  // Handle delete confirmation modal setup
  const deleteModal = new bootstrap.Modal(document.getElementById('deleteConfirmationModal'));
  let currentDeleteForm = null;
  let currentDeleteButton = null;

  // Handle delete button clicks for price tiers
  document.addEventListener('click', function(e) {
    // Handle delete tier button clicks
    if (e.target.closest('.delete-tier-btn')) {
      e.preventDefault();
      const button = e.target.closest('.delete-tier-btn');
      const tierId = button.dataset.tierId;
      const row = button.closest('.price-tier-row');
      
      if (confirm('Are you sure you want to delete this price tier?')) {
        // Show loading state
        button.disabled = true;
        button.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>';
        
        // Send DELETE request
        fetch(`/vendor/price-tier/${tierId}/delete/`, {
          method: 'POST',
          headers: {
            'X-CSRFToken': csrftoken,
            'X-Requested-With': 'XMLHttpRequest',
          },
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Remove the row from the UI
            row.remove();
            // Show success message
            showAlert('Price tier deleted successfully!', 'success');
          } else {
            throw new Error(data.message || 'Failed to delete price tier');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          showAlert('Error deleting price tier: ' + error.message, 'danger');
          button.disabled = false;
          button.innerHTML = '<i class="fas fa-trash"></i>';
        });
      }
    }
  });

  // Handle remove button clicks for unsaved tiers
  document.querySelectorAll('.remove-tier-btn').forEach(button => {
    button.addEventListener('click', function() {
      this.closest('.price-tier-row').remove();
      // Update the TOTAL_FORMS count
      const totalForms = document.getElementById('id_price_tier-TOTAL_FORMS');
      totalForms.value = parseInt(totalForms.value) - 1;
    });
  });

  // Handle confirm delete button click
  document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
    if (currentDeleteForm) {
      // Show loading state
      const originalText = currentDeleteButton.innerHTML;
      currentDeleteButton.disabled = true;
      currentDeleteButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Deleting...';
      
      // Submit the form
      currentDeleteForm.submit();
    }
    deleteModal.hide();
  });

  // Handle form submission
  const priceTierForm = document.getElementById('price-tier-form');
  if (priceTierForm) {
    priceTierForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Get the submit button and show loading state
      const submitButton = this.querySelector('button[type="submit"]');
      const originalText = submitButton.innerHTML;
      submitButton.disabled = true;
      submitButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Saving...';
      
      // Submit the form data
      const formData = new FormData(this);
      
      fetch(this.action || window.location.href, {
        method: 'POST',
        body: formData,
        headers: {
          'X-Requested-With': 'XMLHttpRequest',
        },
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showAlert('Price tiers saved successfully!', 'success');
          // Optionally reload the page to reflect changes
          setTimeout(() => window.location.reload(), 1000);
        } else {
          throw new Error(data.message || 'Failed to save price tiers');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showAlert('Error saving price tiers: ' + error.message, 'danger');
      })
      .finally(() => {
        submitButton.disabled = false;
        submitButton.innerHTML = originalText;
      });
    });
  }

  // Add tier form handling
  const addTierBtn = document.getElementById('add-tier');
  if (addTierBtn) {
    addTierBtn.addEventListener('click', function() {
      const formCount = document.querySelectorAll('.price-tier-row').length;
      const formsetContainer = document.getElementById('price-tiers-container');
      const emptyForm = formsetContainer.querySelector('.price-tier-row:last-child').cloneNode(true);
      
      // Update form field names and IDs
      const formRegex = RegExp(`(price_tier-)(\\d+)(-)`, 'g');
      const replacement = `price_tier-${formCount}-`;
      
      emptyForm.innerHTML = emptyForm.innerHTML.replace(formRegex, replacement);
      
      // Clear values
      emptyForm.querySelectorAll('input:not([type=hidden])').forEach(input => {
        input.value = '';
      });
      
      // Update the TOTAL_FORMS count
      const totalForms = document.getElementById('id_price_tier-TOTAL_FORMS');
      totalForms.value = formCount + 1;
      
      // Add the new form to the container
      formsetContainer.appendChild(emptyForm);
      
      // Reinitialize tooltips for the new elements
      var newTooltipTriggerList = [].slice.call(emptyForm.querySelectorAll('[data-bs-toggle="tooltip"]'));
      newTooltipTriggerList.forEach(function (tooltipTriggerEl) {
        new bootstrap.Tooltip(tooltipTriggerEl);
      });
      
      // Add event listener for the remove button
      const removeBtn = emptyForm.querySelector('.remove-tier-btn');
      if (removeBtn) {
        removeBtn.addEventListener('click', function() {
          emptyForm.remove();
          totalForms.value = parseInt(totalForms.value) - 1;
        });
      }
    });
  }

  // Promise fees handling
  const addPromiseFeeBtn = document.getElementById('add-promise-fee');
  const promiseFeesContainer = document.getElementById('promise-fees-container');
  
  if (addPromiseFeeBtn) {
    addPromiseFeeBtn.addEventListener('click', function() {
      const feeRow = document.createElement('div');
      feeRow.className = 'promise-fee-row mb-4 p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-3 border border-gray-200';
      
      // Get the current number of fee rows to generate unique names
      const feeCount = document.querySelectorAll('.promise-fee-row').length;
      
      feeRow.innerHTML = `
        <div class="row g-3">
          <div class="col-md-3">
            <label class="form-label fw-bold">Fee Name</label>
            <input type="text" name="fee_${feeCount}_name" class="form-control" placeholder="e.g., Basic, Premium, Express">
          </div>
          <div class="col-md-3">
            <label class="form-label fw-bold">Min Percentage (%)</label>
            <div class="input-group">
              <input type="number" name="fee_${feeCount}_min_percent" class="form-control" step="0.01" min="0" max="100" placeholder="0.00" value="0">
              <span class="input-group-text">%</span>
            </div>
          </div>
          <div class="col-md-3">
            <label class="form-label fw-bold">Max Percentage (%)</label>
            <div class="input-group">
              <input type="number" name="fee_${feeCount}_max_percent" class="form-control" step="0.01" min="0" max="100" placeholder="0.00" value="0">
              <span class="input-group-text">%</span>
            </div>
          </div>
          <div class="col-md-3 d-flex align-items-end">
            <button type="button" class="btn btn-outline-danger btn-sm remove-promise-fee hover-lift">
              <svg class="w-4 h-4 me-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
              </svg>
              Remove
            </button>
          </div>
        </div>
      `;
      
      promiseFeesContainer.appendChild(feeRow);
      
      // Add event listener for remove button
      const removeBtn = feeRow.querySelector('.remove-promise-fee');
      removeBtn.addEventListener('click', function() {
        feeRow.remove();
      });
    });
  }

  // Handle delete promise fee buttons
  document.querySelectorAll('.delete-promise-fee').forEach(button => {
    button.addEventListener('click', function() {
      const feeId = this.getAttribute('data-fee-id');
      if (confirm('Are you sure you want to delete this promise fee?')) {
        // Here you would typically make an AJAX call to delete the fee
        // For now, we'll just remove the row
        this.closest('.promise-fee-row').remove();
      }
    });
  });

  // Handle IRate form submission
  const iRateForm = document.getElementById('i-rate-form');
  if (iRateForm) {
    iRateForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const submitButton = this.querySelector('button[type="submit"]');
      const originalText = submitButton.innerHTML;
      submitButton.disabled = true;
      submitButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Saving...';
      
      const formData = new FormData(this);
      
      fetch(this.action || window.location.href, {
        method: 'POST',
        body: formData,
        headers: {
          'X-Requested-With': 'XMLHttpRequest',
        },
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showAlert('IRates saved successfully!', 'success');
          setTimeout(() => window.location.reload(), 1000);
        } else {
          throw new Error(data.message || 'Failed to save IRates');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showAlert('Error saving IRates: ' + error.message, 'danger');
      })
      .finally(() => {
        submitButton.disabled = false;
        submitButton.innerHTML = originalText;
      });
    });
  }

  // Add IRate form handling
  const addRateBtn = document.getElementById('add-rate');
  if (addRateBtn) {
    addRateBtn.addEventListener('click', function() {
      const formCount = document.querySelectorAll('.i-rate-row').length;
      const formsetContainer = document.getElementById('i-rates-container');
      const emptyForm = formsetContainer.querySelector('.i-rate-row:last-child').cloneNode(true);
      
      // Update form field names and IDs
      const formRegex = RegExp(`(irate-)(\\d+)(-)`, 'g');
      const replacement = `irate-${formCount}-`;
      
      emptyForm.innerHTML = emptyForm.innerHTML.replace(formRegex, replacement);
      
      // Clear values
      emptyForm.querySelectorAll('input:not([type=hidden])').forEach(input => {
        input.value = '';
      });
      
      // Update the TOTAL_FORMS count
      const totalForms = document.getElementById('id_irate-TOTAL_FORMS');
      totalForms.value = formCount + 1;
      
      // Add the new form to the container
      formsetContainer.appendChild(emptyForm);
      
      // Reinitialize tooltips for the new elements
      var newTooltipTriggerList = [].slice.call(emptyForm.querySelectorAll('[data-bs-toggle="tooltip"]'));
      newTooltipTriggerList.forEach(function (tooltipTriggerEl) {
        new bootstrap.Tooltip(tooltipTriggerEl);
      });
      
      // Add event listener for the remove button
      const removeBtn = emptyForm.querySelector('.remove-rate-btn');
      if (removeBtn) {
        removeBtn.addEventListener('click', function() {
          emptyForm.remove();
          totalForms.value = parseInt(totalForms.value) - 1;
        });
      }
    });
  }

  // Handle remove button clicks for unsaved IRates
  document.querySelectorAll('.remove-rate-btn').forEach(button => {
    button.addEventListener('click', function() {
      this.closest('.i-rate-row').remove();
      // Update the TOTAL_FORMS count
      const totalForms = document.getElementById('id_irate-TOTAL_FORMS');
      totalForms.value = parseInt(totalForms.value) - 1;
    });
  });

  // Handle promise fee form submission
  const promiseFeeForm = document.getElementById('promise-fee-form');
  if (promiseFeeForm) {
    promiseFeeForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const submitButton = this.querySelector('button[type="submit"]');
      const originalButtonText = submitButton.innerHTML;
      
      // Disable the button and show loading state
      submitButton.disabled = true;
      submitButton.innerHTML = `
        <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Saving...
      `;
      
      // Create a FormData object from the form
      const formData = new FormData(this);
      
      // Add the fee ID if it exists
      const feeId = this.querySelector('.delete-promise-fee')?.dataset.feeId;
      if (feeId) {
        formData.append('fee_id', feeId);
      }
      
      // Submit the form data using fetch
      fetch(window.location.href, {
        method: 'POST',
        body: formData,
        headers: {
          'X-Requested-With': 'XMLHttpRequest',
        },
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showAlert('Promise fee saved successfully!', 'success');
          // Reload the page to show the updated data
          setTimeout(() => window.location.reload(), 1000);
        } else {
          throw new Error(data.message || 'Failed to save promise fee');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showAlert(error.message || 'An error occurred while saving the promise fee', 'danger');
        submitButton.disabled = false;
        submitButton.innerHTML = originalButtonText;
      });
    });
    
    // Handle delete promise fee
    const deleteFeeBtn = document.querySelector('.delete-promise-fee');
    if (deleteFeeBtn) {
      deleteFeeBtn.addEventListener('click', function() {
        if (confirm('Are you sure you want to delete this promise fee? This action cannot be undone.')) {
          const feeId = this.dataset.feeId;
          if (!feeId) return;
          
          const form = document.createElement('form');
          form.method = 'POST';
          form.action = window.location.href;
          
          // Add CSRF token
          const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
          if (csrfToken) {
            const csrfInput = document.createElement('input');
            csrfInput.type = 'hidden';
            csrfInput.name = 'csrfmiddlewaretoken';
            csrfInput.value = csrfToken.value;
            form.appendChild(csrfInput);
          }
          
          // Add delete flag and fee ID
          const deleteInput = document.createElement('input');
          deleteInput.type = 'hidden';
          deleteInput.name = 'delete_promise_fee';
          deleteInput.value = '1';
          form.appendChild(deleteInput);
          
          const feeIdInput = document.createElement('input');
          feeIdInput.type = 'hidden';
          feeIdInput.name = 'fee_id';
          feeIdInput.value = feeId;
          form.appendChild(feeIdInput);
          
          // Submit the form
          document.body.appendChild(form);
          form.submit();
        }
      });
    }
  }
  
  // Add Interest Rate
  document.querySelectorAll('#add-interest-rate').forEach(button => {
    button.addEventListener('click', function() {
      const form = document.getElementById('add-interest-rate-form');
      if (form) {
        const submitButton = this;
        const originalText = submitButton.innerHTML;
        submitButton.disabled = true;
        submitButton.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Adding...';
        
        fetch(window.location.href, {
          method: 'POST',
          body: new FormData(form),
          headers: {
            'X-Requested-With': 'XMLHttpRequest',
          },
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            window.location.reload();
          } else {
            throw new Error(data.message || 'Failed to add interest rate');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          showAlert(`Error adding interest rate: ${error.message}`, 'danger');
          submitButton.disabled = false;
          submitButton.innerHTML = originalText;
        });
      }
    });
  });

  // Delete Interest Rate
  document.querySelectorAll('.delete-interest-rate').forEach(button => {
    button.addEventListener('click', function() {
      const rateId = this.dataset.rateId;
      if (confirm('Are you sure you want to delete this interest rate?')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = window.location.href;
        form.innerHTML = `
          <input type="hidden" name="delete_i_rate" value="1">
          <input type="hidden" name="rate_id" value="${rateId}">
          {% csrf_token %}
        `;
        document.body.appendChild(form);
        form.submit();
      }
    });
  });

  // Submit Interest Rate Form
  document.querySelectorAll('form[id^="interest-rate-form-"]').forEach(form => {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const submitButton = this.querySelector('button[type="submit"]');
      const originalText = submitButton.innerHTML;
      submitButton.disabled = true;
      submitButton.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Saving...';
      
      const formData = new FormData(this);
      
      fetch(window.location.href, {
        method: 'POST',
        body: formData,
        headers: {
          'X-Requested-With': 'XMLHttpRequest',
        },
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showAlert('Interest rate updated successfully!', 'success');
          // Update the last updated time
          const timeElement = this.querySelector('.last-updated-time');
          if (timeElement) {
            timeElement.textContent = `Last updated: ${new Date().toLocaleString()}`;
          }
        } else {
          throw new Error(data.message || 'Failed to update interest rate');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showAlert(`Error: ${error.message}`, 'danger');
      })
      .finally(() => {
        submitButton.disabled = false;
        submitButton.innerHTML = originalText;
      });
    });
  });

  // Helper function to show alerts
  function showAlert(message, type = 'info') {
    // Create alert element
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
    alertDiv.role = 'alert';
    alertDiv.innerHTML = `
      ${message}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    `;
    
    // Add to the top of the page
    const container = document.querySelector('.container');
    if (container) {
      container.insertBefore(alertDiv, container.firstChild);
      
      // Auto-dismiss after 5 seconds
      setTimeout(() => {
        const alert = bootstrap.Alert.getOrCreateInstance(alertDiv);
        alert.close();
      }, 5000);
    }
  }
});
</script>
{% endblock %}
    </main>
  </div>
</div>
{% endblock %}
